# WorkflowEngine

[‰∏≠Êñá](README.md) | [English](README_EN.md) | –†—É—Å—Å–∫–∏–π

<p align="center">
  <strong>–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —É–∑–ª–æ–≤ + –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π runtime</strong><br>
  –°–æ–µ–¥–∏–Ω—è–π—Ç–µ –±–ª–æ–∫–∏ –≤–º–µ—Å—Ç–æ –∫–æ–¥–∞, —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –≤—Å—ë —Å –ø–æ–º–æ—â—å—é Lua
</p>

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∫–æ–¥–∞** ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —É–∑–ª–æ–≤, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤, WYSIWYG
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Lua-—Å–∫—Ä–∏–ø—Ç–∞–º–∏** ‚Äî –∫–∞–∂–¥—ã–π Block ‚Äî —ç—Ç–æ Lua-—Å–∫—Ä–∏–ø—Ç —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
- **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –ø–∞–∫–µ—Ç –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
- **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî macOS (ARM/Intel) + Windows
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–ª–Ω—ã–π API –¥–ª—è USB-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

## üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç

<img width="1403" height="863" alt="image" src="https://github.com/user-attachments/assets/7201603f-72a7-4035-b66b-c1bc7106df32" />

https://github.com/user-attachments/assets/08793b5b-d584-44a1-b641-9e8912ce3061

## üì¶ –°–∫–∞—á–∞—Ç—å

–ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –Ω–∞ [Releases](https://github.com/LegnaOS/workflow-game/releases):

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –§–∞–π–ª |
|-----------|------|
| macOS Apple Silicon | `workflow_engine-*-macos-arm64.tar.gz` |
| macOS Intel | `workflow_engine-*-macos-x64.tar.gz` |
| Windows x64 | `workflow_engine-*-windows-x64.zip` |

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞:**
```
‚îú‚îÄ‚îÄ workflow_engine    # IDE —Ä–µ–¥–∞–∫—Ç–æ—Ä
‚îú‚îÄ‚îÄ workflow_player    # –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –ø–ª–µ–µ—Ä
‚îú‚îÄ‚îÄ scripts/           # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
‚îú‚îÄ‚îÄ workflows/         # –ü—Ä–∏–º–µ—Ä—ã workflow
‚îî‚îÄ‚îÄ docs/              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ workflow

```
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow_engine
2. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –±–ª–æ–∫—É –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
3. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –æ—Ç –ø–æ—Ä—Ç–∞ –∫ –¥—Ä—É–≥–æ–º—É –ø–æ—Ä—Ç—É –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±–ª–æ–∫–∞ –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
5. –ù–∞–∂–º–∏—Ç–µ ¬´‚ñ∂ –ó–∞–ø—É—Å–∫¬ª –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
```

**–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:**
| –î–µ–π—Å—Ç–≤–∏–µ | –ö–ª–∞–≤–∏—à–∏ |
|----------|---------|
| –°–æ—Ö—Ä–∞–Ω–∏—Ç—å | `Ctrl/Cmd + S` |
| –û—Ç–∫—Ä—ã—Ç—å | `Ctrl/Cmd + O` |
| –û—Ç–º–µ–Ω–∏—Ç—å | `Ctrl/Cmd + Z` |
| –ü–æ–≤—Ç–æ—Ä–∏—Ç—å | `Ctrl/Cmd + Shift + Z` |
| –£–¥–∞–ª–∏—Ç—å | `Delete / Backspace` |
| –í—ã–¥–µ–ª–µ–Ω–∏–µ | –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –Ω–∞ –ø—É—Å—Ç–æ–º –º–µ—Å—Ç–µ |
| –ü–∞–Ω–æ—Ä–∞–º–∞ | `Space + –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å` –∏–ª–∏ —Å—Ä–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞ |
| –ú–∞—Å—à—Ç–∞–± | –ö–æ–ª–µ—Å–æ –º—ã—à–∏ |

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–≥—Ä—ã

```
1. –ù–∞–∂–º–∏—Ç–µ ¬´üì¶ –ü—É–±–ª–∏–∫–∞—Ü–∏—è¬ª –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ò–º—è–ò–≥—Ä—ã_publish/
‚îú‚îÄ‚îÄ workflow_player    # –ü–ª–µ–µ—Ä (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π)
‚îî‚îÄ‚îÄ –ò–º—è–ò–≥—Ä—ã.lpack      # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –ø–∞–∫–µ—Ç
```

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –≤—Å—é –ø–∞–ø–∫—É. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç `workflow_player`.

## üìÑ –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –§–æ—Ä–º–∞—Ç | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|------------|--------|------------|
| `.L` | –û—Ç–∫—Ä—ã—Ç—ã–π JSON | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π |
| `.LZ` | AES-128 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | –ó–∞—â–∏—Ç–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ |
| `.lpack` | –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞–∫–µ—Ç | –ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ (—Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏) |

## üß© –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤

–ë–ª–æ–∫–∏ ‚Äî —ç—Ç–æ Lua-—Å–∫—Ä–∏–ø—Ç—ã. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤ –ø–∞–ø–∫—É `scripts/`, –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π.

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**
```lua
return {
    meta = {
        id = "my.double",
        name = "–£–¥–≤–æ–µ–Ω–∏–µ",
        category = "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
        color = "#FF5722"
    },
    inputs = {
        { id = "value", name = "–í—Ö–æ–¥", type = "number", default = 0 }
    },
    outputs = {
        { id = "result", name = "–†–µ–∑—É–ª—å—Ç–∞—Ç", type = "number", default = 0 }
    },
    execute = function(self, inputs)
        return { result = inputs.value * 2 }
    end
}
```

**–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [docs/BLOCK_DEVELOPMENT_RU.md](docs/BLOCK_DEVELOPMENT_RU.md)

## üìö –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤

```
scripts/
‚îú‚îÄ‚îÄ game/        # –ò–≥—Ä–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–ø–µ—Ä—Å–æ–Ω–∞–∂, –º–æ–Ω—Å—Ç—Ä, –∞—Ç–∞–∫–∞)
‚îú‚îÄ‚îÄ lite/        # Lite RPG (–≥–µ—Ä–æ–π, –±–æ—Å—Å, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, –Ω–∞–≤—ã–∫–∏)
‚îú‚îÄ‚îÄ logic/       # –õ–æ–≥–∏–∫–∞ (–≤–µ—Ç–≤–ª–µ–Ω–∏–µ, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, —Å–µ–ª–µ–∫—Ç–æ—Ä)
‚îú‚îÄ‚îÄ math/        # –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (—Å–ª–æ–∂–µ–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ, –≤—ã—Ä–∞–∂–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ input/       # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤–≤–æ–¥ (—Ç–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∞, –ø–∞—Ä–æ–ª—å)
‚îú‚îÄ‚îÄ usb/         # USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å)
‚îú‚îÄ‚îÄ event/       # –°–æ–±—ã—Ç–∏—è (—Å—Ç–∞—Ä—Ç, –ø–µ—á–∞—Ç—å)
‚îú‚îÄ‚îÄ util/        # –£—Ç–∏–ª–∏—Ç—ã (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ–ª—å, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
‚îî‚îÄ‚îÄ debug/       # –û—Ç–ª–∞–¥–∫–∞ (–ª–æ–≥–≥–µ—Ä)
```

## üîß –°–±–æ—Ä–∫–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Rust 1.70+
- –î–ª—è –∫—Ä–æ—Å—Å-–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –Ω—É–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ toolchain

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
cargo run

# Release —Å–±–æ—Ä–∫–∞
cargo build --release

# –†–µ–∑—É–ª—å—Ç–∞—Ç
target/release/workflow_engine  # IDE
target/release/workflow_player  # –ü–ª–µ–µ—Ä
```

**–°–∫—Ä–∏–ø—Ç –º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏:**
```bash
./build.sh  # –°–æ–±–∏—Ä–∞–µ—Ç macOS + Windows, –≤—ã–≤–æ–¥ –≤ dist/
```

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.rs              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ IDE
‚îú‚îÄ‚îÄ player.rs            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø–ª–µ–µ—Ä–∞
‚îú‚îÄ‚îÄ app.rs               # –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (2000+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ script/
‚îÇ   ‚îú‚îÄ‚îÄ parser.rs        # –ü–∞—Ä—Å–∏–Ω–≥ Lua-—Å–∫—Ä–∏–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ registry.rs      # –†–µ–µ—Å—Ç—Ä –±–ª–æ–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ executor.rs      # –î–≤–∏–∂–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ loader.rs        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (UTF-8/GBK)
‚îú‚îÄ‚îÄ workflow/
‚îÇ   ‚îú‚îÄ‚îÄ graph.rs         # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∞ workflow
‚îÇ   ‚îú‚îÄ‚îÄ block.rs         # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ connection.rs    # –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ package.rs       # –ò–≥—Ä–æ–≤–æ–π –ø–∞–∫–µ—Ç .lpack
‚îÇ   ‚îî‚îÄ‚îÄ storage.rs       # –§–∞–π–ª–æ–≤—ã–π I/O + —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ canvas.rs        # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ö–æ–ª—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ block_widget.rs  # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–ª–æ–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ connection_widget.rs  # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ usb/
    ‚îú‚îÄ‚îÄ lua_bindings.rs  # USB Lua API
    ‚îî‚îÄ‚îÄ types.rs         # –¢–∏–ø—ã USB
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –Ø–∑—ã–∫ | Rust |
| GUI | egui / eframe |
| –°–∫—Ä–∏–ø—Ç–∏–Ω–≥ | mlua (Lua 5.4) |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | AES-128-CBC |
| USB | rusb / libusb |
| –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è | serde + serde_json |

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
